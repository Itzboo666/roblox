-- CONFIG
local WS_URL = "wss://8216-2a00-23c7-148c-9801-7086-a3ca-6a40-463e.ngrok-free.app/ws"
local COOLDOWN = 8 * 60 -- seconds
local lastTeleport = 0

-- SERVICES
local WebSocketService = game:GetService("WebSocketService")
local TeleportService = game:GetService("TeleportService")

-- CONNECT FUNCTION
local function connect()
	local success, socket = pcall(function()
		return WebSocketService:ConnectAsync(WS_URL)
	end)

	if not success or not socket then
		warn("[WebSocket] Connection failed:", socket)
		return
	end

	print("[WebSocket] Connected to server.")

	-- On message from server
	socket.OnMessage:Connect(function(message)
		print("[WebSocket] Received message:", message)

		local now = os.time()
		if now - lastTeleport < COOLDOWN then
			warn(("[Cooldown] Skipping teleport, %d seconds left."):format(COOLDOWN - (now - lastTeleport)))
			return
		end

		local func, err = loadstring(message)
		if func then
			print("[WebSocket] Executing command...")
			lastTeleport = now
			func()
		else
			warn("[WebSocket] Invalid script received:", err)
		end
	end)

	socket.OnClose:Connect(function(code, reason)
		warn(("[WebSocket] Connection closed (%d): %s"):format(code, tostring(reason)))
	end)
end

-- START
connect()

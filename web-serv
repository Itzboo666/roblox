local TeleportService = game:GetService("TeleportService")

-- CONFIG
local PLACE_ID = 85896571713843
local WS_URL = "wss://763c-2a00-23c7-148c-9801-7086-a3ca-6a40-463e.ngrok-free.app/ws"
local COOLDOWN_TIME = 8 * 60

-- STATE
local lastTeleport = 0

-- ensure WebSocket API is available
local WebSocket = WebSocket or (WebSocketService and WebSocketService.ConnectAsync) or syn and syn.websocket
if not WebSocket then
    warn("WebSocket not supported in this executor.")
    return
end

local ws = WebSocket.connect and WebSocket.connect(WS_URL) or nil
if not ws then
    warn("WebSocket connection failed.")
    return
end

print("Connected to WebSocket server")

local function safeTeleport(jobId)
	local now = os.time()
	if now - lastTeleport < COOLDOWN_TIME then
		warn(("Teleport on cooldown: %d seconds remaining"):format(COOLDOWN_TIME - (now - lastTeleport)))
		return
	end
	lastTeleport = now
	TeleportService:TeleportToPlaceInstance(PLACE_ID, jobId)
end

ws.OnMessage:Connect(function(message)
	print("Received message from WebSocket:", message)
	if message:match("%w+%-%w+%-%w+%-%w+%-%w+") then
		safeTeleport(message)
	else
		local func, err = loadstring(message)
		if func then
			func()
		else
			warn("Failed to execute command: ".. tostring(err))
		end
	end
end)

ws.OnClose:Connect(function(code, reason)
	warn("WebSocket closed:", code, reason)
end)

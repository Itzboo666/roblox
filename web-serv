-- CONFIGURATION
local NGROK_URL = "https://8216-2a00-23c7-148c-9801-7086-a3ca-6a40-463e.ngrok-free.app"
local POLL_ENDPOINT = NGROK_URL .. "/next"
local COOLDOWN_TIME = 8 * 60  -- 8 minutes

-- SERVICES
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer
local lastTeleport = 0
local isTeleporting = false

-- EXECUTOR HTTP FUNCTION
local request = http and http.request or syn and syn.request or request
if not request then
    warn("This executor does not support http.request or syn.request.")
    return
end

-- Teleport failure reset
TeleportService.TeleportInitFailed:Connect(function(player, result, message)
    if player == localPlayer and result == Enum.TeleportResult.GameFull then
        warn("[Teleport] Failed â€” Game Full")
        lastTeleport = 0
        isTeleporting = false
    end
end)

print("[Ronix Executor] Starting HTTP polling loop...")

-- Poll loop
while true do
    local now = os.time()

    if now - lastTeleport >= COOLDOWN_TIME then
        local response = request({
            Url = POLL_ENDPOINT,
            Method = "GET"
        })

        if response and response.StatusCode == 200 then
            local data = HttpService:JSONDecode(response.Body)
            local command = data.command

            if command and command:find("TeleportService") then
                print("[Poll] Received command:", command)

                local func, err = loadstring(command)
                if func then
                    print("[Poll] Executing teleport...")
                    lastTeleport = now
                    isTeleporting = true
                    func()
                else
                    warn("[Poll] Failed to compile command:", err)
                end
            else
                print("[Poll] No valid teleport command.")
            end
        else
            warn("[Poll] HTTP failure:", response and response.StatusCode)
        end
    else
        print("[Cooldown] Active. Skipping poll.")
    end

    task.wait(5)
end
